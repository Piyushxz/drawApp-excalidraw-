(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[250],{90178:(e,t,s)=>{Promise.resolve().then(s.bind(s,57444))},57444:(e,t,s)=>{"use strict";s.d(t,{default:()=>eI});var i=s(36694),a=s(83286),o=s(58183),n=s(52354);function r(e){return(0,i.jsx)("div",{onClick:e.onClick,className:"md:p-3 p-1 rounded-lg ".concat("circle"===e.selectedTool?" border border-gray-600 ":" hover:bg-gray-600/30"," "),children:(0,i.jsx)(n.A,{className:"text-white size-5 md:size-4"})})}var l=s(40495);function d(e){return(0,i.jsx)("div",{onClick:e.onClick,className:"md:p-3 p-1 rounded-lg ".concat("pencil"===e.selectedTool?" border border-gray-600":" hover:bg-gray-600/30"," "),children:(0,i.jsx)(l.A,{className:"text-white size-4"})})}var h=s(63582);function c(e){return(0,i.jsx)("div",{onClick:e.onClick,className:"md:p-3 p-1 rounded-lg ".concat("rect"===e.selectedTool?" border border-gray-600":" hover:bg-gray-600/30"," "),children:(0,i.jsx)(h.A,{className:"text-white size-4"})})}function x(e){return(0,i.jsx)("div",{onClick:e.onClick,className:"md:p-2 p-1 rounded-lg ".concat("diamond"===e.selectedTool?" border border-gray-600 ":" hover:bg-gray-600/30"," "),children:(0,i.jsx)("svg",{className:"md:size-6 size-4",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"#F7F7F7","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",children:(0,i.jsx)("path",{d:"M2.7 10.3a2.41 2.41 0 0 0 0 3.41l7.59 7.59a2.41 2.41 0 0 0 3.41 0l7.59-7.59a2.41 2.41 0 0 0 0-3.41l-7.59-7.59a2.41 2.41 0 0 0-3.41 0Z"})})})}let u=e=>(0,i.jsx)("div",{onClick:e.onClick,className:" md:p-2 p-1 rounded-lg ".concat("line"===e.selectedTool?" border border-gray-600 ":" hover:bg-gray-600/30"," "),children:(0,i.jsx)("svg",{className:"size-4 md:size-6",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"#F7F7F7","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",children:(0,i.jsx)("path",{d:"M5 12h14"})})}),p=e=>(0,i.jsx)("div",{onClick:e.onClick,className:"md:p-3 p-1 rounded-lg ".concat("arrow"===e.selectedTool?" border border-gray-600 ":""," hover:bg-gray-600/30"),children:(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"#F7F7F7","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",className:"lucide lucide-move-right size-4",children:[(0,i.jsx)("path",{d:"M18 8L22 12L18 16"}),(0,i.jsx)("path",{d:"M2 12H22"})]})});var m=s(246);let g=e=>(0,i.jsx)("div",{onClick:e.onClick,className:"md:p-3 p-1 rounded-lg ".concat("eraser"===e.selectedTool?" border border-gray-600 ":" hover:bg-gray-600/30"," "),children:(0,i.jsx)(m.A,{className:"text-white size-4"})});var v=s(1457);let f=e=>(0,i.jsx)("div",{onClick:e.onClick,className:"md:p-3 p-1 rounded-lg ".concat("mouse"===e.selectedTool?" border border-gray-600 ":""," hover:bg-gray-600/30"),children:(0,i.jsx)(v.A,{className:"text-white size-4"})});var y=s(44851);let k=e=>(0,i.jsx)("div",{onClick:e.onClick,className:"md:p-3 p-1 rounded-lg ".concat("hand"===e.selectedTool?" border border-gray-600 ":""," hover:bg-gray-600/30"),children:(0,i.jsx)(y.A,{className:"text-white size-4"})});var b=s(52413);let w=e=>(0,i.jsx)("div",{onClick:e.onClick,className:"md:p-3 p-1 rounded-lg ".concat("text"===e.selectedTool?" border border-gray-600 ":""," hover:bg-gray-600/30"),children:(0,i.jsx)(b.A,{className:"text-white size-4"})}),S={hand:"Pan canvas - Click and drag to move around",mouse:"Select & move - Click to select, drag to move shapes",rect:"Rectangle - Click and drag to draw",circle:"Ellipse - Click and drag to draw",pencil:"Freehand - Click and drag to draw freely",diamond:"Diamond - Click and drag to draw",line:"Line - Click and drag to draw straight line",arrow:"Arrow - Click and drag to draw arrow",text:"Text - Double click to add text anywhere on the canvas",eraser:"Eraser - Click to delete shapes"};function j(e){let{selectedTool:t,setSelectedTool:s}=e;return(0,i.jsxs)("div",{className:"w-screen flex flex-col items-center",children:[(0,i.jsxs)("div",{className:"fixed py-1 translate-y-4 bg-[#191919] rounded-lg shadow-lg px-2 border border-gray-600/30 flex items-center gap-1 md:gap-1.5",children:[(0,i.jsx)(k,{selectedTool:t,size:"md",onClick:()=>s("hand")}),(0,i.jsx)(f,{selectedTool:t,size:"md",onClick:()=>s("mouse")}),(0,i.jsx)("div",{className:"h-6 md:h-8 border border-white/15"}),(0,i.jsx)(c,{selectedTool:t,size:"md",onClick:()=>s("rect")}),(0,i.jsx)(r,{selectedTool:t,size:"md",onClick:()=>s("circle")}),(0,i.jsx)(d,{selectedTool:t,size:"md",onClick:()=>s("pencil")}),(0,i.jsx)(x,{selectedTool:t,size:"md",onClick:()=>s("diamond")}),(0,i.jsx)(u,{selectedTool:t,size:"md",onClick:()=>s("line")}),(0,i.jsx)(p,{selectedTool:t,size:"md",onClick:()=>s("arrow")}),(0,i.jsx)(w,{selectedTool:t,size:"md",onClick:()=>s("text")}),(0,i.jsx)("div",{className:"h-6 md:h-8 border border-white/15"}),(0,i.jsx)(g,{selectedTool:t,size:"md",onClick:()=>s("eraser")})]}),(0,i.jsx)("div",{className:"fixed md:translate-y-[75px] translate-y-[60px]",children:(0,i.jsx)("h4",{className:"flex text-xs text-black/50 dark:text-white/50",children:S[t]})})]})}var C=s(18900);async function N(e){let t=(await C.A.get("".concat(o.f,"/chats/").concat(e))).data.chats;return console.log("response",t),t.map(e=>{let{id:t,message:s}=e,i=JSON.parse(s);return{id:t,shape:i.shape,color:(null==i?void 0:i.color)||"#ffffff",strokeWidth:(null==i?void 0:i.strokeWidth)||2}})}function I(e,t,s,i,a,o){let n,r,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:5,d=a-s,h=o-i,c=d*d+h*h,x=0!==c?((e-s)*d+(t-i)*h)/c:-1;x<0?(n=s,r=i):x>1?(n=a,r=o):(n=s+x*d,r=i+x*h);let u=e-n,p=t-r;return Math.sqrt(u*u+p*p)<=l}class M{updateTransform(e,t){this.zoom=e,this.panOffset=t}setTheme(e){this.isDarkTheme="dark"===e||"system"===e&&window.matchMedia("(prefers-color-scheme: dark)").matches,this.renderCanvas()}notifyCanvasUpdate(){this.onCanvasUpdate&&this.onCanvasUpdate()}setFont(e){switch(e){case"handwriting":default:this.currentFont="Virgil";break;case"code":this.currentFont="Comic Sans MS";break;case"normal":this.currentFont="Satoshi"}this.renderCanvas()}setFontSize(e){this.fontSize=e,this.renderCanvas()}screenToCanvas(e,t){let s=this.zoom/100;return{x:(e-this.panOffset.x)/s,y:(t-this.panOffset.y)/s}}canvasToScreen(e,t){let s=this.zoom/100;return{x:e*s+this.panOffset.x,y:t*s+this.panOffset.y}}getDistance(e,t){let s=t.x-e.x,i=t.y-e.y;return Math.sqrt(s*s+i*i)}getTouchCenter(e,t){return{x:(e.clientX+t.clientX)/2,y:(e.clientY+t.clientY)/2}}updateShapeColor(e,t){let s=this.existingShapes.find(t=>t.id===e);s&&(s.color=t,console.log("shape",s)),this.renderCanvas(),this.notifyCanvasUpdate(),this.socket.send(JSON.stringify({type:"update_shape_color",id:e,shape:s,color:t,roomId:this.roomId,sentBy:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6ImI0Y2Q4ZWM3LTM1NWUtNGZlYy04YzNiLWIwYzUyYmU1MTFlMCIsImlhdCI6MTc1MzgwNjQ1NH0.bER-qZ5Lvk39mxILYj8O09aIjFeA5x8A1mST4dLyu7I"}))}updateText(e,t,s){let i=this.existingShapes.find(t=>t.id===e);if(i&&"text"===i.shape.type){let e=i.shape;e.fontSize=t,e.fontFamily=s,console.log("shape",i)}this.renderCanvas(),this.notifyCanvasUpdate(),this.socket.send(JSON.stringify({type:"update_shape_text",id:e,shape:i,roomId:this.roomId,sentBy:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6ImI0Y2Q4ZWM3LTM1NWUtNGZlYy04YzNiLWIwYzUyYmU1MTFlMCIsImlhdCI6MTc1MzgwNjQ1NH0.bER-qZ5Lvk39mxILYj8O09aIjFeA5x8A1mST4dLyu7I"}))}updateShapeStrokeWidth(e,t){let s=this.existingShapes.find(t=>t.id===e);s&&(s.strokeWidth=t,console.log("shape",s)),this.renderCanvas(),this.notifyCanvasUpdate(),this.socket.send(JSON.stringify({type:"update_shape_stroke_width",id:e,shape:s,strokeWidth:t,roomId:this.roomId,sentBy:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6ImI0Y2Q4ZWM3LTM1NWUtNGZlYy04YzNiLWIwYzUyYmU1MTFlMCIsImlhdCI6MTc1MzgwNjQ1NH0.bER-qZ5Lvk39mxILYj8O09aIjFeA5x8A1mST4dLyu7I"}))}drawSelectionBox(){if(!this.clickedShape)return;let e=this.getSelectionBoxBounds();if(!e)return;let t=e.maxX-e.minX,s=e.maxY-e.minY;this.ctx.strokeStyle="#0096FF",this.ctx.lineWidth=1,this.ctx.setLineDash([4,4]),this.ctx.strokeRect(e.minX,e.minY,t,s),this.ctx.setLineDash([]),this.drawResizeHandles(e.minX,e.minY,t,s)}drawResizeHandles(e,t,s,i){this.ctx.fillStyle="#ffffff",this.ctx.strokeStyle="#0096FF",this.ctx.lineWidth=1.5,[{x:e-2,y:t-2},{x:e+s-6+2,y:t-2},{x:e+s-6+2,y:t+i-6+2},{x:e-2,y:t+i-6+2}].forEach(e=>{this.ctx.beginPath(),this.ctx.roundRect(e.x,e.y,6,6,2),this.ctx.fill(),this.ctx.stroke()})}drawRoundedRect(e,t,s,i){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8,o=s<0?e+s:e,n=i<0?t+i:t,r=Math.abs(s),l=Math.abs(i),d=Math.min(a,Math.min(r,l)/2);this.ctx.beginPath(),this.ctx.moveTo(o+d,n),this.ctx.lineTo(o+r-d,n),this.ctx.quadraticCurveTo(o+r,n,o+r,n+d),this.ctx.lineTo(o+r,n+l-d),this.ctx.quadraticCurveTo(o+r,n+l,o+r-d,n+l),this.ctx.lineTo(o+d,n+l),this.ctx.quadraticCurveTo(o,n+l,o,n+l-d),this.ctx.lineTo(o,n+d),this.ctx.quadraticCurveTo(o,n,o+d,n),this.ctx.closePath(),this.ctx.stroke()}drawPreview(){this.ctx.save(),this.ctx.translate(this.panOffset.x,this.panOffset.y),this.ctx.scale(this.zoom/100,this.zoom/100),this.ctx.strokeStyle=this.isDarkTheme?"rgba(255, 255, 255)":"rgba(0, 0, 0)",this.ctx.lineWidth=1;let e=this.selectedTool,t=this.currentMouseX-this.startX,s=this.currentMouseY-this.startY;if("rect"===e)this.drawRoundedRect(this.startX,this.startY,t,s);else if("circle"===e){let e=this.startX+t/2,i=this.startY+s/2,a=Math.abs(t)/2,o=Math.abs(s)/2;this.ctx.beginPath(),this.ctx.ellipse(e,i,a,o,0,0,2*Math.PI),this.ctx.stroke(),this.ctx.closePath()}else if("pencil"===e){this.ctx.beginPath();for(let e=0;e<this.pencilPath.length-1;e++)this.ctx.moveTo(this.pencilPath[e].x,this.pencilPath[e].y),this.ctx.lineTo(this.pencilPath[e+1].x,this.pencilPath[e+1].y);this.ctx.lineWidth=2,this.ctx.stroke(),this.ctx.closePath()}else if("diamond"===e){let e=this.startX+t/2,i=this.startY+s/2,a=this.startY,o=this.startX+t,n=this.startY+s,r=this.startX;this.ctx.beginPath(),this.ctx.moveTo(e,a),this.ctx.lineTo(o,i),this.ctx.lineTo(e,n),this.ctx.lineTo(r,i),this.ctx.closePath(),this.ctx.stroke()}else if("line"===e)this.ctx.beginPath(),this.ctx.moveTo(this.startX,this.startY),this.ctx.lineTo(this.currentMouseX,this.currentMouseY),this.ctx.stroke();else if("arrow"===e){let e=Math.atan2(this.currentMouseY-this.startY,this.currentMouseX-this.startX);this.ctx.beginPath(),this.ctx.lineCap="round",this.ctx.lineWidth=2.5,this.ctx.moveTo(this.startX,this.startY),this.ctx.lineTo(this.currentMouseX,this.currentMouseY);let t=this.currentMouseX-14*Math.cos(e-Math.PI/6),s=this.currentMouseY-14*Math.sin(e-Math.PI/6),i=this.currentMouseX-14*Math.cos(e+Math.PI/6),a=this.currentMouseY-14*Math.sin(e+Math.PI/6);this.ctx.moveTo(this.currentMouseX,this.currentMouseY),this.ctx.lineTo(t,s),this.ctx.moveTo(this.currentMouseX,this.currentMouseY),this.ctx.lineTo(i,a),this.ctx.stroke()}this.ctx.restore()}destroy(){this.canvas.removeEventListener("mousedown",this.mouseDownHandler),this.canvas.removeEventListener("mouseup",this.mouseUpHandler),this.canvas.removeEventListener("mousemove",this.mouseMoveHandler),this.canvas.removeEventListener("touchstart",this.touchStartHandler),this.canvas.removeEventListener("touchend",this.touchEndHandler),this.canvas.removeEventListener("touchmove",this.touchMoveHandler)}setTool(e){this.selectedTool=e,"arrow"!==this.selectedTool&&"mouse"!==this.selectedTool&&(this.clickedShape=void 0,this.clickedShapeIndex=-1),this.updateCursor()}getSelectionBoxBounds(){if(!this.clickedShape)return null;let e=this.clickedShape.shape;if("rect"===e.type){let t=e.width<0?e.x+e.width:e.x,s=e.height<0?e.y+e.height:e.y;return{minX:t-8,minY:s-8,maxX:t+Math.abs(e.width)+8,maxY:s+Math.abs(e.height)+8}}if("circle"===e.type){var t,s,i,a;let o=Math.abs(null!==(s=null!==(t=e.radiusX)&&void 0!==t?t:e.radius)&&void 0!==s?s:0),n=Math.abs(null!==(a=null!==(i=e.radiusY)&&void 0!==i?i:e.radius)&&void 0!==a?a:0);return{minX:e.centerX-o-8,minY:e.centerY-n-8,maxX:e.centerX+o+8,maxY:e.centerY+n+8}}if("diamond"===e.type)return{minX:Math.min(e.x1,e.x2,e.x3,e.x4)-8,minY:Math.min(e.y1,e.y2,e.y3,e.y4)-8,maxX:Math.max(e.x1,e.x2,e.x3,e.x4)+8,maxY:Math.max(e.y1,e.y2,e.y3,e.y4)+8};if("line"===e.type||"arrow"===e.type)return{minX:Math.min(e.x1,e.x2)-8,minY:Math.min(e.y1,e.y2)-8,maxX:Math.max(e.x1,e.x2)+8,maxY:Math.max(e.y1,e.y2)+8};if("pencil"===e.type){if(e.points.length>0)return{minX:Math.min(...e.points.map(e=>e.x))-8,minY:Math.min(...e.points.map(e=>e.y))-8,maxX:Math.max(...e.points.map(e=>e.x))+8,maxY:Math.max(...e.points.map(e=>e.y))+8}}else if("text"===e.type){this.ctx.font="".concat(e.fontSize,"px ").concat(e.fontFamily,", sans-serif");let t=this.ctx.measureText(e.text).width,s=e.fontSize;return{minX:e.x-8,minY:e.y-8,maxX:e.x+t+8,maxY:e.y+s+8}}return null}getResizeHandle(e,t){if(!this.clickedShape)return"";let s=this.getSelectionBoxBounds();return s?e>=s.maxX-6-2&&e<=s.maxX+2&&t>=s.maxY-6-2&&t<=s.maxY+2?"se":e>=s.minX-2&&e<=s.minX+6+2&&t>=s.maxY-6-2&&t<=s.maxY+2?"sw":e>=s.maxX-6-2&&e<=s.maxX+2&&t>=s.minY-2&&t<=s.minY+6+2?"ne":e>=s.minX-2&&e<=s.minX+6+2&&t>=s.minY-2&&t<=s.minY+6+2?"nw":"":""}setupMobileOptimizations(){let e=0;this.canvas.addEventListener("touchend",t=>{let s=new Date().getTime();s-e<=300&&t.preventDefault(),e=s},!1),this.canvas.addEventListener("contextmenu",e=>{e.preventDefault()}),this.canvas.style.touchAction="manipulation"}updateCursor(){if(this.canvas){if(this.isResizing){this.canvas.style.cursor="nw-resize";return}if(this.isDragging&&"mouse"===this.selectedTool){this.canvas.style.cursor="grabbing";return}if("mouse"===this.selectedTool&&this.clickedShape){let e=this.getResizeHandle(this.currentMouseX,this.currentMouseY);if(e){switch(e){case"nw":case"se":this.canvas.style.cursor="nw-resize";break;case"ne":case"sw":this.canvas.style.cursor="ne-resize";break;case"n":case"s":this.canvas.style.cursor="ns-resize";break;case"e":case"w":this.canvas.style.cursor="ew-resize"}return}}switch(this.selectedTool){case"rect":case"circle":case"diamond":case"line":case"arrow":case"pencil":this.canvas.style.cursor="crosshair";break;case"eraser":this.canvas.style.cursor='url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><circle cx="10" cy="10" r="8" fill="none" stroke="white" stroke-width="2"/><circle cx="10" cy="10" r="6" fill="none" stroke="black" stroke-width="1"/></svg>\') 10 10, auto';break;case"mouse":default:this.canvas.style.cursor="default";break;case"hand":this.canvas.style.cursor="grab";break;case"text":this.canvas.style.cursor="text"}}}sendText(){this.socket.send(JSON.stringify({type:"text",text:this.text.text,x:this.text.x,y:this.text.y,fontSize:this.fontSize,fontFamily:this.currentFont,roomId:this.roomId,sentBy:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6ImI0Y2Q4ZWM3LTM1NWUtNGZlYy04YzNiLWIwYzUyYmU1MTFlMCIsImlhdCI6MTc1MzgwNjQ1NH0.bER-qZ5Lvk39mxILYj8O09aIjFeA5x8A1mST4dLyu7I"})),this.setSelectedTool("mouse")}clearCanvas(){this.existingShapes=[],this.renderCanvas(),this.clickedShape=void 0,this.clickedShapeIndex=-1,this.prevShape=void 0,this.socket.send(JSON.stringify({type:"clear_canvas",roomId:this.roomId,sentBy:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6ImI0Y2Q4ZWM3LTM1NWUtNGZlYy04YzNiLWIwYzUyYmU1MTFlMCIsImlhdCI6MTc1MzgwNjQ1NH0.bER-qZ5Lvk39mxILYj8O09aIjFeA5x8A1mST4dLyu7I"}))}clearSelection(){this.clickedShape=void 0,this.clickedShapeIndex=-1,this.renderCanvas()}isPointInsideShape(e,t,s){if("rect"===s.type){let i=s.width<0?s.x+s.width:s.x,a=s.height<0?s.y+s.height:s.y,o=Math.abs(s.width),n=Math.abs(s.height);return e>=i&&e<=i+o&&t>=a&&t<=a+n}if("circle"===s.type){var i,a,o,n;let r=null!==(a=null!==(i=s.radiusX)&&void 0!==i?i:s.radius)&&void 0!==a?a:0,l=null!==(n=null!==(o=s.radiusY)&&void 0!==o?o:s.radius)&&void 0!==n?n:0;if(0===r&&0===l)return!1;let d=(e-s.centerX)/r,h=(t-s.centerY)/l;return d*d+h*h<=1}if("diamond"===s.type)return function(e,t,s){let i=0,a=s.length;for(let o=0;o<a;o++){let n=s[o],r=s[(o+1)%a];n.y>t!=r.y>t&&e<(r.x-n.x)*(t-n.y)/(r.y-n.y)+n.x&&i++}return i%2==1}(e,t,[{x:s.x1,y:s.y1},{x:s.x2,y:s.y2},{x:s.x3,y:s.y3},{x:s.x4,y:s.y4}]);if("line"===s.type||"arrow"===s.type)return I(e,t,s.x1,s.y1,s.x2,s.y2);if("pencil"===s.type)return function(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5;for(let a=0;a<s.length-1;a++)if(I(e,t,s[a].x,s[a].y,s[a+1].x,s[a+1].y,i))return!0;return!1}(e,t,s.points);if("text"===s.type){this.ctx.font="".concat(s.fontSize,"px ").concat(s.fontFamily,", sans-serif");let i=this.ctx.measureText(s.text).width,a=s.fontSize;return e>=s.x&&e<=s.x+i&&t>=s.y&&t<=s.y+a}return!1}async init(){this.existingShapes=await N(this.roomId),console.log("shapes",this.existingShapes),this.renderCanvas()}deleteShape(){if(void 0===this.clickedShapeIndex){console.error("Error: clickedShapeIndex is undefined.");return}this.existingShapes=this.existingShapes.filter(e=>{let{id:t}=e;return t!==this.clickedShapeIndex}),this.renderCanvas(),this.socket.send(JSON.stringify({type:"delete_shape",shape:this.clickedShapeIndex,roomId:this.roomId,sentBy:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6ImI0Y2Q4ZWM3LTM1NWUtNGZlYy04YzNiLWIwYzUyYmU1MTFlMCIsImlhdCI6MTc1MzgwNjQ1NH0.bER-qZ5Lvk39mxILYj8O09aIjFeA5x8A1mST4dLyu7I"})),this.clickedShape=void 0,this.clickedShapeIndex=-1,this.prevShape=void 0}initHandlers(){this.socket.onmessage=e=>{var t,s;let i=JSON.parse(e.data);if("chat"==i.type){console.log(i);let e=JSON.parse(i.id),t=JSON.parse(i.message);console.log("parsedSHape",t);let s={shape:t.shape,id:e};this.existingShapes.push(s),this.clickedShape=s,this.clickedShapeIndex=e,this.prevShape=JSON.parse(JSON.stringify(s)),this.renderCanvas()}else if("delete_shape"==i.type){console.log("delete shape ",i);let e=JSON.parse(i.id);this.clickedShapeIndex===e&&(this.clickedShape=void 0,this.clickedShapeIndex=-1,this.prevShape=void 0),this.existingShapes=this.existingShapes.filter(t=>{let{id:s}=t;return s!==e}),this.renderCanvas()}else if("update_shape"===i.type){i.sentBy,console.log("update shape msg rcvd ",i);let e=this.existingShapes.findIndex(e=>e.id===i.shape.id);-1!==e?this.existingShapes[e].shape=i.shape.shape:this.existingShapes.push({id:i.shape.id,shape:i.shape.shape}),this.renderCanvas()}else if("update_shape_color"===i.type){console.log("update_shape_color received 69",i);let e=this.existingShapes.findIndex(e=>e.id===i.id);-1!==e&&(this.existingShapes[e].color=i.color,this.renderCanvas())}else if("update_shape_stroke_width"===i.type){console.log("update_shape_stroke_width received 69",i);let e=this.existingShapes.findIndex(e=>e.id===i.id);-1!==e&&(this.existingShapes[e].shape,this.existingShapes[e].strokeWidth=null===(t=i.shape)||void 0===t?void 0:t.strokeWidth,this.renderCanvas())}else if("text"===i.type){console.log("text message received",i);let e=i.id,t={shape:{type:"text",x:i.x,y:i.y,text:i.text,fontSize:i.fontSize,fontFamily:i.fontFamily},id:e};this.existingShapes.push(t),i.sentBy===(null===(s=this.session)||void 0===s?void 0:s.accessToken)&&(this.clickedShape=t,this.clickedShapeIndex=e,this.prevShape=JSON.parse(JSON.stringify(t))),this.renderCanvas()}else if("update_shape_text"===i.type){console.log("update_shape_text received",i);let e=i.id,t=this.existingShapes.findIndex(t=>t.id===e);if(-1!==t){let e={type:"text",x:i.shape.shape.x,y:i.shape.shape.y,text:i.shape.shape.text,fontSize:i.shape.shape.fontSize,fontFamily:i.shape.shape.fontFamily};this.existingShapes[t].shape=e}this.renderCanvas()}else"clear_canvas"===i.type&&(this.existingShapes=[],this.clickedShape=void 0,this.clickedShapeIndex=-1,this.prevShape=void 0,this.renderCanvas())}}renderCanvas(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle=this.isDarkTheme?"rgba(18,18,18,255)":"rgba(255, 255, 255, 1)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.onCanvasUpdate&&this.onCanvasUpdate(),this.ctx.save(),this.ctx.translate(this.panOffset.x,this.panOffset.y),this.ctx.scale(this.zoom/100,this.zoom/100),this.existingShapes.forEach(e=>{var t,s,i,a,o,n,r,l;let{shape:d,id:h,color:c,strokeWidth:x}=e;if(d&&d.type&&h){if(this.ctx.strokeStyle=c||(this.isDarkTheme?"#ffffff":"#000000"),this.ctx.lineWidth=x||2,this.ctx.fillStyle=c||(this.isDarkTheme?"#ffffff":"#000000"),(null==d?void 0:d.type)==="rect")this.drawRoundedRect(d.x,d.y,d.width,d.height);else if((null==d?void 0:d.type)==="circle"){let e=Math.abs(null!==(s=null!==(t=d.radiusX)&&void 0!==t?t:d.radius)&&void 0!==s?s:0),o=Math.abs(null!==(a=null!==(i=d.radiusY)&&void 0!==i?i:d.radius)&&void 0!==a?a:0);e>0&&o>0&&(this.ctx.beginPath(),this.ctx.ellipse(d.centerX,d.centerY,e,o,0,0,2*Math.PI),this.ctx.stroke(),this.ctx.closePath())}else if((null==d?void 0:d.type)==="diamond")this.ctx.beginPath(),this.ctx.moveTo(d.x1,d.y1),this.ctx.lineTo(d.x2,d.y2),this.ctx.lineTo(d.x3,d.y3),this.ctx.lineTo(d.x4,d.y4),this.ctx.closePath(),this.ctx.stroke();else if((null==d?void 0:d.type)==="line")this.ctx.beginPath(),this.ctx.moveTo(d.x1,d.y1),this.ctx.lineTo(d.x2,d.y2),this.ctx.stroke();else if((null==d?void 0:d.type)==="arrow"){let e=Math.atan2(d.y2-d.y1,d.x2-d.x1);this.ctx.beginPath(),this.ctx.moveTo(d.x1,d.y1),this.ctx.lineTo(d.x2,d.y2);let t=d.x2-14*Math.cos(e-Math.PI/6),s=d.y2-14*Math.sin(e-Math.PI/6),i=d.x2-14*Math.cos(e+Math.PI/6),a=d.y2-14*Math.sin(e+Math.PI/6);this.ctx.moveTo(d.x2,d.y2),this.ctx.lineTo(t,s),this.ctx.moveTo(d.x2,d.y2),this.ctx.lineTo(i,a),this.ctx.stroke()}else if((null==d?void 0:d.type)==="pencil"){console.log("rendering pencil",d);for(let e=0;e<(null!==(n=null===(o=d.points)||void 0===o?void 0:o.length)&&void 0!==n?n:0)-1;e++){let t=null===(r=d.points)||void 0===r?void 0:r[e],s=null===(l=d.points)||void 0===l?void 0:l[e+1];t&&s&&(this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(s.x,s.y),this.ctx.lineWidth=x||2,this.ctx.stroke())}}else(null==d?void 0:d.type)==="text"&&(this.ctx.font="".concat(d.fontSize,"px ").concat(d.fontFamily,", sans-serif"),this.ctx.textBaseline="top",this.ctx.fillText(d.text,d.x,d.y));this.clickedShape&&this.clickedShape.shape}}),this.drawSelectionBox(),this.ctx.restore()}initMouseHandlers(){this.canvas.addEventListener("mousedown",this.mouseDownHandler),this.canvas.addEventListener("mouseup",this.mouseUpHandler),this.canvas.addEventListener("mousemove",this.mouseMoveHandler),this.canvas.addEventListener("touchstart",this.touchStartHandler,{passive:!1}),this.canvas.addEventListener("touchend",this.touchEndHandler,{passive:!1}),this.canvas.addEventListener("touchmove",this.touchMoveHandler,{passive:!1}),this.canvas.addEventListener("touchstart",e=>e.preventDefault(),{passive:!1}),this.canvas.addEventListener("touchmove",e=>e.preventDefault(),{passive:!1})}constructor(e,t,s,i,a,o="dark",n){this.startX=0,this.startY=0,this.currentMouseX=0,this.currentMouseY=0,this.pencilPath=[],this.selectedTool="circle",this.diamondCoords={P1:{x:0,y:0},P2:{x:0,y:0},P3:{x:0,y:0},P4:{x:0,y:0}},this.lineCoords={P1:{x:0,y:0},P2:{x:0,y:0}},this.arrowCoords={P1:{x:0,y:0},P2:{x:0,y:0}},this.clickedShapeIndex=-1,this.isDarkTheme=!0,this.text={text:"",x:0,y:0,fontSize:24,fontFamily:"Virgil"},this.currentFont="Virgil",this.fontSize=24,this.isDragging=!1,this.dragOffset={x:0,y:0},this.isResizing=!1,this.resizeHandle="",this.resizeStartData={width:0,height:0,x:0,y:0},this.zoom=100,this.panOffset={x:0,y:0},this.isPanning=!1,this.isZooming=!1,this.lastTouchDistance=0,this.lastTouchCenter={x:0,y:0},this.initialZoom=100,this.initialPanOffset={x:0,y:0},this.mouseDownHandler=e=>{this.clicked=!0;let t=this.screenToCanvas(e.clientX,e.clientY);if(this.startX=t.x,this.startY=t.y,this.isDragging=!1,console.log(this.selectedTool,"tool"),"mouse"!==this.selectedTool&&this.clearSelection(),"mouse"===this.selectedTool){if(this.clickedShape){let e=this.getResizeHandle(t.x,t.y);if(e){this.isResizing=!0,this.resizeHandle=e;let t=this.clickedShape.shape;if("rect"===t.type)this.resizeStartData={width:t.width,height:t.height,x:t.x,y:t.y};else if("circle"===t.type){var s,i,a,o;let e=Math.abs(null!==(i=null!==(s=t.radiusX)&&void 0!==s?s:t.radius)&&void 0!==i?i:0),n=Math.abs(null!==(o=null!==(a=t.radiusY)&&void 0!==a?a:t.radius)&&void 0!==o?o:0);this.resizeStartData={width:2*e,height:2*n,x:t.centerX-e,y:t.centerY-n}}else if("diamond"===t.type){let e=Math.min(t.x1,t.x2,t.x3,t.x4),s=Math.min(t.y1,t.y2,t.y3,t.y4),i=Math.max(t.x1,t.x2,t.x3,t.x4),a=Math.max(t.y1,t.y2,t.y3,t.y4);this.resizeStartData={width:i-e,height:a-s,x:e,y:s}}else"line"===t.type||"arrow"===t.type?this.resizeStartData={width:t.x2-t.x1,height:t.y2-t.y1,x:t.x1,y:t.y1}:"text"===t.type&&(this.resizeStartData={width:t.fontSize,height:t.fontSize,x:t.x,y:t.y});return}}let e=this.existingShapes.find(e=>{let{shape:s}=e;return this.isPointInsideShape(t.x,t.y,s)});if(e){switch(this.clickedShape=e,console.log("clicked shape 818818",this.clickedShape),this.clickedShapeIndex=e.id,this.prevShape=JSON.parse(JSON.stringify(e)),this.isDragging=!0,e.shape.type){case"rect":case"text":this.dragOffset={x:t.x-e.shape.x,y:t.y-e.shape.y};break;case"diamond":let s=(e.shape.x1+e.shape.x2+e.shape.x3+e.shape.x4)/4,i=(e.shape.y1+e.shape.y2+e.shape.y3+e.shape.y4)/4;this.dragOffset={x:t.x-s,y:t.y-i};break;case"circle":this.dragOffset={x:t.x-e.shape.centerX,y:t.y-e.shape.centerY};break;case"line":case"arrow":this.dragOffset={x:t.x-e.shape.x1,y:t.y-e.shape.y1};break;case"pencil":if("pencil"===e.shape.type){let s=e.shape;s.points.length>0&&(this.dragOffset={x:t.x-s.points[0].x,y:t.y-s.points[0].y})}}console.log("text",this.text),this.renderCanvas(),this.updateCursor()}else this.clickedShape=void 0,this.clickedShapeIndex=-1,this.renderCanvas()}},this.mouseUpHandler=e=>{var t,s;this.clicked=!1;let i=this.screenToCanvas(e.clientX,e.clientY),a=i.x-this.startX,o=i.y-this.startY;if(this.isDragging=!1,this.isResizing&&this.clickedShape){this.isResizing=!1,this.resizeHandle="",this.socket.send(JSON.stringify({type:"update_shape",message:JSON.stringify({shape:this.clickedShape}),roomId:this.roomId,sentBy:(null===(t=this.session)||void 0===t?void 0:t.accessToken)||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6ImI0Y2Q4ZWM3LTM1NWUtNGZlYy04YzNiLWIwYzUyYmU1MTFlMCIsImlhdCI6MTc1MzgwNjQ1NH0.bER-qZ5Lvk39mxILYj8O09aIjFeA5x8A1mST4dLyu7I"}));return}let n=this.selectedTool,r=null;console.log("clicled",JSON.stringify(this.clickedShape),"clicked",JSON.stringify(this.prevShape));let l=JSON.stringify(this.clickedShape)===JSON.stringify(this.prevShape);if("mouse"!==this.selectedTool||!this.clickedShape||this.isDragging||l||(console.log("shape changed ",this.clickedShape),this.socket.send(JSON.stringify({type:"update_shape",message:JSON.stringify({shape:this.clickedShape}),roomId:this.roomId,sentBy:(null===(s=this.session)||void 0===s?void 0:s.accessToken)||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6ImI0Y2Q4ZWM3LTM1NWUtNGZlYy04YzNiLWIwYzUyYmU1MTFlMCIsImlhdCI6MTc1MzgwNjQ1NH0.bER-qZ5Lvk39mxILYj8O09aIjFeA5x8A1mST4dLyu7I"}))),this.updateCursor(),"rect"===n)r={type:"rect",x:this.startX,y:this.startY,height:o,width:a};else if("circle"===n){let e=this.startX+a,t=this.startY+o,s=(this.startX+e)/2;r={type:"circle",centerX:s,centerY:(this.startY+t)/2,radiusX:Math.abs(e-this.startX)/2,radiusY:Math.abs(t-this.startY)/2}}else if("pencil"===n)console.log("pencil inserting",r={type:"pencil",points:this.pencilPath}),this.pencilPath=[];else if("diamond"===n)r={type:"diamond",x1:this.diamondCoords.P1.x,y1:this.diamondCoords.P1.y,x2:this.diamondCoords.P2.x,y2:this.diamondCoords.P2.y,x3:this.diamondCoords.P3.x,y3:this.diamondCoords.P3.y,x4:this.diamondCoords.P4.x,y4:this.diamondCoords.P4.y},this.diamondCoords={P1:{x:0,y:0},P2:{x:0,y:0},P3:{x:0,y:0},P4:{x:0,y:0}};else if("line"===n)r={type:"line",x1:this.lineCoords.P1.x,y1:this.lineCoords.P1.y,x2:this.lineCoords.P2.x,y2:this.lineCoords.P2.y},this.lineCoords={P1:{x:0,y:0},P2:{x:0,y:0}};else if("arrow"===n)r={type:"arrow",x1:this.arrowCoords.P1.x,y1:this.arrowCoords.P1.y,x2:this.arrowCoords.P2.x,y2:this.arrowCoords.P2.y};else if("text"===n){this.text.x=i.x,this.text.y=i.y;return}r&&(console.log(r),this.socket.send(JSON.stringify({type:"chat",message:JSON.stringify({shape:r}),roomId:this.roomId})),this.setSelectedTool("mouse"))},this.touchStartHandler=e=>{if(e.preventDefault(),1===e.touches.length){if("hand"===this.selectedTool){this.isPanning=!0,this.initialPanOffset={...this.panOffset};let t=e.touches[0];this.lastTouchCenter={x:t.clientX,y:t.clientY}}else{let t=e.touches[0],s=new MouseEvent("mousedown",{clientX:t.clientX,clientY:t.clientY,button:0});this.mouseDownHandler(s)}}else if(2===e.touches.length){this.isZooming=!0,this.initialZoom=this.zoom,this.initialPanOffset={...this.panOffset};let t=e.touches[0],s=e.touches[1];this.lastTouchDistance=this.getDistance({x:t.clientX,y:t.clientY},{x:s.clientX,y:s.clientY}),this.lastTouchCenter=this.getTouchCenter(t,s)}},this.touchEndHandler=e=>{if(e.preventDefault(),this.isPanning=!1,this.isZooming=!1,0===e.touches.length&&this.clicked&&"hand"!==this.selectedTool){let t=e.changedTouches[0],s=new MouseEvent("mouseup",{clientX:t.clientX,clientY:t.clientY,button:0});this.mouseUpHandler(s)}},this.touchMoveHandler=e=>{if(e.preventDefault(),this.isPanning&&1===e.touches.length){let t=e.touches[0],s=t.clientX-this.lastTouchCenter.x,i=t.clientY-this.lastTouchCenter.y;this.panOffset.x=this.initialPanOffset.x+s,this.panOffset.y=this.initialPanOffset.y+i,this.renderCanvas()}else if(this.isZooming&&2===e.touches.length){let t=e.touches[0],s=e.touches[1],i=this.getDistance({x:t.clientX,y:t.clientY},{x:s.clientX,y:s.clientY}),a=this.getTouchCenter(t,s),o=i/this.lastTouchDistance,n=Math.max(25,Math.min(400,this.initialZoom*o)),r=this.screenToCanvas(a.x,a.y),l=this.screenToCanvas(this.lastTouchCenter.x,this.lastTouchCenter.y),d=r.x-l.x,h=r.y-l.y,c=n/this.initialZoom;this.zoom=n,this.panOffset.x=this.initialPanOffset.x-d*(c-1),this.panOffset.y=this.initialPanOffset.y-h*(c-1),this.renderCanvas()}else if(1===e.touches.length&&!this.isPanning&&!this.isZooming){let t=e.touches[0],s=new MouseEvent("mousemove",{clientX:t.clientX,clientY:t.clientY,button:0});this.mouseMoveHandler(s)}},this.mouseMoveHandler=e=>{if(this.clicked){let t=this.screenToCanvas(e.clientX,e.clientY);this.currentMouseX=t.x,this.currentMouseY=t.y;let s=t.x-this.startX,i=t.y-this.startY;if(this.renderCanvas(),this.drawPreview(),"pencil"===this.selectedTool){let e=t.x,s=t.y;this.pencilPath.push({x:e,y:s})}if("diamond"===this.selectedTool){let e=this.startX+s/2,t=this.startY+i/2;this.diamondCoords.P1={x:e,y:this.startY},this.diamondCoords.P2={x:this.startX+s,y:t},this.diamondCoords.P3={x:e,y:this.startY+i},this.diamondCoords.P4={x:this.startX,y:t}}if("line"===this.selectedTool&&(this.lineCoords.P1={x:this.startX,y:this.startY},this.lineCoords.P2={x:t.x,y:t.y}),"arrow"===this.selectedTool)this.arrowCoords.P1={x:this.startX,y:this.startY},this.arrowCoords.P2={x:t.x,y:t.y};else if("eraser"===this.selectedTool){let e=this.existingShapes.find(e=>{let{shape:s}=e;return this.isPointInsideShape(t.x,t.y,s)});e?(console.log(e.id,"del"),this.clickedShapeIndex=e.id,console.log(this.clickedShapeIndex,"pleasw"),this.deleteShape()):console.log("no shape to del")}else if("text"===this.selectedTool)return}if(this.isResizing&&this.clickedShape&&this.clicked&&"mouse"===this.selectedTool){let t=this.screenToCanvas(e.clientX,e.clientY),s=t.x-this.startX,i=t.y-this.startY,a=this.clickedShape.shape;if("rect"===a.type){let t=this.resizeStartData.width,o=this.resizeStartData.height,n=this.resizeStartData.x,r=this.resizeStartData.y,l=e.shiftKey,d=t/o,h=t,c=o,x=n,u=r;switch(this.resizeHandle){case"se":h=t+s,c=o+i,l&&(c=h/d);break;case"sw":x=n+s,h=t-s,c=o+i,l&&(c=h/d);break;case"ne":u=r+i,h=t+s,c=o-i,l&&(c=h/d);break;case"nw":x=n+s,u=r+i,h=t-s,c=o-i,l&&(c=h/d)}Math.abs(h)>=10&&Math.abs(c)>=10&&(a.x=x,a.y=u,a.width=h,a.height=c)}else if("circle"===a.type){let t=this.resizeStartData.width/2,o=this.resizeStartData.height/2,n=this.resizeStartData.x+t,r=this.resizeStartData.y+o,l=e.shiftKey,d=t,h=o,c=n,x=r;switch(this.resizeHandle){case"se":if(d=t+s/2,h=o+i/2,c=n+s/2,x=r+i/2,l){let e=Math.max(d,h);d=e,h=e}break;case"sw":if(c=n+s/2,d=t-s/2,h=o+i/2,l){let e=Math.max(Math.abs(d),Math.abs(h));d=e,h=e}break;case"ne":if(d=t+s/2,h=o-i/2,c=n+s/2,x=r+i/2,l){let e=Math.max(Math.abs(d),Math.abs(h));d=e,h=e}break;case"nw":if(c=n+s/2,x=r+i/2,d=t-s/2,h=o-i/2,l){let e=Math.max(Math.abs(d),Math.abs(h));d=e,h=e}}Math.abs(d)>=5&&Math.abs(h)>=5&&(a.centerX=c,a.centerY=x,a.radiusX=Math.abs(d),a.radiusY=Math.abs(h))}else if("diamond"===a.type){let t=this.resizeStartData.width,o=this.resizeStartData.height,n=this.resizeStartData.x+t/2,r=this.resizeStartData.y+o/2,l=e.shiftKey,d=t/o,h=t,c=o,x=n,u=r;switch(this.resizeHandle){case"se":x=n+s/2,u=r+i/2,h=t+s,c=o+i,l&&(c=h/d);break;case"sw":x=n+s/2,u=r+i/2,h=t-s,c=o+i,l&&(c=h/d);break;case"ne":x=n+s/2,u=r+i/2,h=t+s,c=o-i,l&&(c=h/d);break;case"nw":x=n+s/2,u=r+i/2,h=t-s,c=o-i,l&&(c=h/d)}if(Math.abs(h)>=10&&Math.abs(c)>=10){let e=h/2,t=c/2;a.x1=x,a.y1=u-t,a.x2=x+e,a.y2=u,a.x3=x,a.y3=u+t,a.x4=x-e,a.y4=u}}else if("line"===a.type||"arrow"===a.type){let e=this.resizeStartData.x,t=this.resizeStartData.y,o=e+this.resizeStartData.width,n=t+this.resizeStartData.height;switch(this.resizeHandle){case"se":a.x2=o+s,a.y2=n+i;break;case"nw":a.x1=e+s,a.y1=t+i;break;case"ne":a.x2=o+s,a.y1=t+i;break;case"sw":a.x1=e+s,a.y2=n+i}}else if("text"===a.type){let e=this.resizeStartData.width,t=this.resizeStartData.x,o=this.resizeStartData.y,n=Math.max(Math.abs(s),Math.abs(i));switch(this.resizeHandle){case"se":a.fontSize=Math.max(8,e+n*(s>0||i>0?1:-1));break;case"sw":a.fontSize=Math.max(8,e+n*(s<0||i>0?1:-1));let r=(a.fontSize-e)*.6;a.x=t-r;break;case"ne":a.fontSize=Math.max(8,e+n*(s>0||i<0?1:-1));let l=a.fontSize-e;a.y=o-l;break;case"nw":a.fontSize=Math.max(8,e+n*(s<0||i<0?1:-1));let d=(a.fontSize-e)*.6,h=a.fontSize-e;a.x=t-d,a.y=o-h}}this.renderCanvas();return}if(this.isDragging&&this.clickedShape&&this.clicked&&"mouse"===this.selectedTool){let t=this.screenToCanvas(e.clientX,e.clientY);switch(this.clickedShape.shape.type){case"rect":case"text":this.clickedShape.shape.x=t.x-this.dragOffset.x,this.clickedShape.shape.y=t.y-this.dragOffset.y;break;case"diamond":let s=t.x-this.dragOffset.x,i=t.y-this.dragOffset.y,a=(this.clickedShape.shape.x1+this.clickedShape.shape.x2+this.clickedShape.shape.x3+this.clickedShape.shape.x4)/4,o=(this.clickedShape.shape.y1+this.clickedShape.shape.y2+this.clickedShape.shape.y3+this.clickedShape.shape.y4)/4,n=s-a,r=i-o;this.clickedShape.shape.x1+=n,this.clickedShape.shape.y1+=r,this.clickedShape.shape.x2+=n,this.clickedShape.shape.y2+=r,this.clickedShape.shape.x3+=n,this.clickedShape.shape.y3+=r,this.clickedShape.shape.x4+=n,this.clickedShape.shape.y4+=r;break;case"circle":this.clickedShape.shape.centerX=t.x-this.dragOffset.x,this.clickedShape.shape.centerY=t.y-this.dragOffset.y;break;case"line":case"arrow":let l=t.x-this.dragOffset.x,d=t.y-this.dragOffset.y,h=l-this.clickedShape.shape.x1,c=d-this.clickedShape.shape.y1;this.clickedShape.shape.x1+=h,this.clickedShape.shape.y1+=c,this.clickedShape.shape.x2+=h,this.clickedShape.shape.y2+=c;break;case"pencil":if("pencil"===this.clickedShape.shape.type){let e=this.clickedShape.shape;if(e.points.length>0){let s=t.x-this.dragOffset.x,i=t.y-this.dragOffset.y;e.points=e.points.map(t=>({x:t.x+s-e.points[0].x,y:t.y+i-e.points[0].y}))}}}this.updateCursor()}},this.resizeCanvas=()=>{this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,console.log("Canvas data",this.canvas.width,this.canvas.height)},this.canvas=e,this.ctx=e.getContext("2d"),this.existingShapes=[],this.roomId=t,this.socket=s,this.clicked=!1,this.init(),this.initHandlers(),this.initMouseHandlers(),this.setSelectedTool=i,this.session=a,this.onCanvasUpdate=n,this.isDarkTheme="dark"===o||"system"===o&&window.matchMedia("(prefers-color-scheme: dark)").matches,this.setupMobileOptimizations(),this.renderCanvas(),this.updateCursor()}}var z=s(95646),T=s(96742);let Y=e=>{let{zoom:t,onZoomChange:s}=e;return(0,i.jsx)("div",{className:"fixed bottom-0 left-0 p-5 md:flex hidden",children:(0,i.jsxs)("div",{className:"flex items-center bg-[#191919] cursor-pointer rounded-lg",children:[(0,i.jsx)("div",{className:"text-white px-4 py-2 hover:bg-gray-800 rounded-l-lg",onClick:()=>{s(Math.max(t-10,10))},children:(0,i.jsx)(z.A,{className:"text-white size-4"})}),(0,i.jsxs)("div",{className:"px-4 text-white py-2 bg-[#191919] text-sm",children:[t,"%"]}),(0,i.jsx)("div",{className:"text-white px-4 py-2 hover:bg-gray-800 rounded-r-lg",onClick:()=>{s(Math.min(t+10,300))},children:(0,i.jsx)(T.A,{className:"text-white size-4"})})]})})},P=e=>{let{canvasRef:t,zoom:s,setZoom:i,panOffset:o,setPanOffset:n,scale:r,game:l}=e,[d,h]=(0,a.useState)(!1),[c,x]=(0,a.useState)({x:0,y:0});(0,a.useEffect)(()=>{let e=t.current;if(!e)return;let a=t=>{t.preventDefault();let a=Math.min(Math.max(s+(t.deltaY<0?10:-10),30),200),l=e.getBoundingClientRect(),d=(t.clientX-l.left-o.x)/r,h=(t.clientY-l.top-o.y)/r;n({x:t.clientX-a/100*d,y:t.clientY-a/100*h}),i(a)},u=e=>{(null==l?void 0:l.selectedTool)==="hand"&&(h(!0),x({x:e.clientX-o.x,y:e.clientY-o.y}))},p=e=>{d&&(null==l?void 0:l.selectedTool)==="hand"&&n({x:e.clientX-c.x,y:e.clientY-c.y})},m=()=>h(!1);return e.addEventListener("wheel",a,{passive:!1}),e.addEventListener("mousedown",u),e.addEventListener("mousemove",p),e.addEventListener("mouseup",m),()=>{e.removeEventListener("wheel",a),e.removeEventListener("mousedown",u),e.removeEventListener("mousemove",p),e.removeEventListener("mouseup",m)}},[r,o,s,i,n,t,l,d,c])};var L=s(84687),X=s(70211),O=s(71955),D=s(67748),E=s(4187);let F=e=>{var t,s,o,n,r,d,h,c,x,u,p,m,g,v,f,y,k,b,w,S,j,C,N,I,M,z,T,Y,P,F,J,H,W;let[A,U]=(0,a.useState)(!1),[Z,_]=(0,a.useState)("#ffffff");(0,a.useEffect)(()=>{var t,s;console.log("ShapeConfigModal useEffect triggered",null===(t=e.game)||void 0===t?void 0:t.clickedShapeIndex,null===(s=e.game)||void 0===s?void 0:s.clickedShape)},[null===(t=e.game)||void 0===t?void 0:t.clickedShapeIndex,null===(s=e.game)||void 0===s?void 0:s.clickedShape,e.canvasUpdateTrigger]),console.log("ShapeConfigModal render",e.showShapeConfigModal,null===(o=e.game)||void 0===o?void 0:o.clickedShape,99);let R=e=>{_(e)};return(0,a.useEffect)(()=>()=>{U(!1)},[e.showShapeConfigModal]),(0,i.jsx)(O.N,{mode:"popLayout",children:e.showShapeConfigModal&&(null===(n=e.game)||void 0===n?void 0:n.selectedTool)!=="eraser"&&(0,i.jsx)(D.P.div,{initial:{x:-100},animate:{x:0},exit:{x:-300},transition:{duration:.2,ease:[.19,1,.22,1]},className:"absolute left-4 font-satoshi  top-36 -translate-y-1/2 w-64 h-auto bg-[#191919] border border-gray-300/10 rounded-lg shadow-lg z-[10] p-4",children:(0,i.jsxs)("div",{className:"flex flex-col gap-3 justify-between mb-3",children:[(0,i.jsx)("p",{className:"text-white text-sm capitalize font-bold",children:null===(r=e.shape)||void 0===r?void 0:r.shape.type}),(0,i.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,i.jsx)("p",{className:"text-white text-sm text-white",children:"Stroke"}),(0,i.jsxs)("div",{className:"flex gap-2 items-center",children:[["#ef4444","#eab308","#3b82f6","#a855f7","#f97316","#ec4899"].map((t,s)=>{var a,o;return(0,i.jsx)("div",{className:"w-6 h-6 rounded-md cursor-pointer transition-all duration-200 hover:scale-110 ".concat((null===(o=e.game)||void 0===o?void 0:null===(a=o.clickedShape)||void 0===a?void 0:a.color)===t?"ring-2 ring-blue-500 ring-offset-2 ring-offset-[#191919] scale-110":""),style:{backgroundColor:t},onClick:()=>{var s,i;null===(i=e.game)||void 0===i||i.updateShapeColor(null===(s=e.game)||void 0===s?void 0:s.clickedShapeIndex,t),R(t)}},s)}),(0,i.jsx)("div",{className:"w-[1px] h-6 bg-gray-500 rounded-md"}),(0,i.jsx)("div",{className:"w-6 h-6 rounded-md cursor-pointer hover:scale-110 transition-transform border border-gray-600",style:{backgroundColor:Z},onClick:()=>U(!A)}),A&&(0,i.jsx)("div",{className:"absolute top-28 left-[142px] z-50",children:(0,i.jsx)(E.kH,{color:Z,onChangeComplete:t=>{var s,i;null===(i=e.game)||void 0===i||i.updateShapeColor(null===(s=e.game)||void 0===s?void 0:s.clickedShapeIndex,t.hex),_(t.hex),U(!1)}})})]})]}),(0,i.jsx)("div",{className:"flex flex-col gap-1",children:(null===(d=e.shape)||void 0===d?void 0:d.shape.type)!=="text"?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("p",{className:"text-white text-sm text-white",children:"Stroke Width"}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("div",{onClick:()=>{var t,s;return null===(s=e.game)||void 0===s?void 0:s.updateShapeStrokeWidth(null===(t=e.game)||void 0===t?void 0:t.clickedShapeIndex,2)},className:"w-10 h-10 rounded-md bg-white flex items-center px-2 transition-all duration-200 ".concat((null===(c=e.game)||void 0===c?void 0:null===(h=c.clickedShape)||void 0===h?void 0:h.strokeWidth)===2?"border-2 border-blue-500 shadow-lg scale-105":"border border-gray-300 hover:border-gray-400"),children:(0,i.jsx)("div",{className:"w-full h-[1px] bg-black/50 rounded-full"})}),(0,i.jsx)("div",{onClick:()=>{var t,s;return null===(s=e.game)||void 0===s?void 0:s.updateShapeStrokeWidth(null===(t=e.game)||void 0===t?void 0:t.clickedShapeIndex,4)},className:"w-10 h-10 rounded-md bg-white flex items-center px-2 transition-all duration-200 ".concat((null===(u=e.game)||void 0===u?void 0:null===(x=u.clickedShape)||void 0===x?void 0:x.strokeWidth)===4?"border-2 border-blue-500 shadow-lg scale-105":"border border-gray-300 hover:border-gray-400"),children:(0,i.jsx)("div",{className:"w-full h-[3px] bg-black/50 rounded-full"})}),(0,i.jsx)("div",{onClick:()=>{var t,s;return null===(s=e.game)||void 0===s?void 0:s.updateShapeStrokeWidth(null===(t=e.game)||void 0===t?void 0:t.clickedShapeIndex,6)},className:"w-10 h-10 rounded-md bg-white flex items-center px-2 transition-all duration-200 ".concat((null===(m=e.game)||void 0===m?void 0:null===(p=m.clickedShape)||void 0===p?void 0:p.strokeWidth)===6?"border-2 border-blue-500 shadow-lg scale-105":"border border-gray-300 hover:border-gray-400"),children:(0,i.jsx)("div",{className:"w-full h-[5px] bg-black/50 rounded-full"})})]})]}):(0,i.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,i.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,i.jsx)("p",{className:"text-white text-sm",children:"Font Size"}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)("button",{onClick:()=>{var t,s,i,a,o,n;null===(t=e.game)||void 0===t||t.setFontSize(24),null===(n=e.game)||void 0===n||n.updateText(null===(s=e.game)||void 0===s?void 0:s.clickedShapeIndex,24,(null===(o=e.game)||void 0===o?void 0:null===(a=o.clickedShape)||void 0===a?void 0:null===(i=a.shape)||void 0===i?void 0:i.fontFamily)||"Satoshi")},title:"Small",className:"size-8 rounded-md bg-white flex items-center justify-center transition-all duration-200 ".concat((null===(f=e.game)||void 0===f?void 0:null===(v=f.clickedShape)||void 0===v?void 0:null===(g=v.shape)||void 0===g?void 0:g.fontSize)===24?"border-2 border-blue-500 shadow-lg scale-105":"border border-gray-300 hover:border-gray-400"),children:(0,i.jsxs)("svg",{"aria-hidden":"true",focusable:"false",role:"img",viewBox:"0 0 20 20",className:"text-black",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round",children:[(0,i.jsx)("g",{"clip-path":"url(#a)",children:(0,i.jsx)("path",{d:"M14.167 6.667a3.333 3.333 0 0 0-3.334-3.334H9.167a3.333 3.333 0 0 0 0 6.667h1.666a3.333 3.333 0 0 1 0 6.667H9.167a3.333 3.333 0 0 1-3.334-3.334",stroke:"currentColor","stroke-width":"1.25","stroke-linecap":"round","stroke-linejoin":"round"})}),(0,i.jsx)("defs",{children:(0,i.jsx)("clipPath",{id:"a",children:(0,i.jsx)("path",{fill:"#fff",d:"M0 0h20v20H0z"})})})]})}),(0,i.jsx)("button",{onClick:()=>{var t,s,i,a,o,n;null===(t=e.game)||void 0===t||t.setFontSize(28),null===(n=e.game)||void 0===n||n.updateText(null===(s=e.game)||void 0===s?void 0:s.clickedShapeIndex,28,(null===(o=e.game)||void 0===o?void 0:null===(a=o.clickedShape)||void 0===a?void 0:null===(i=a.shape)||void 0===i?void 0:i.fontFamily)||"Satoshi")},title:"Medium",className:"size-8 rounded-md bg-white flex items-center justify-center transition-all duration-200 ".concat((null===(b=e.game)||void 0===b?void 0:null===(k=b.clickedShape)||void 0===k?void 0:null===(y=k.shape)||void 0===y?void 0:y.fontSize)===28?"border-2 border-blue-500 shadow-lg scale-105":"border border-gray-300 hover:border-gray-400"),children:(0,i.jsxs)("svg",{"aria-hidden":"true",focusable:"false",role:"img",viewBox:"0 0 20 20",className:"text-black",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round",children:[(0,i.jsx)("g",{"clip-path":"url(#a)",children:(0,i.jsx)("path",{d:"M5 16.667V3.333L10 15l5-11.667v13.334",stroke:"currentColor","stroke-width":"1.25","stroke-linecap":"round","stroke-linejoin":"round"})}),(0,i.jsx)("defs",{children:(0,i.jsx)("clipPath",{id:"a",children:(0,i.jsx)("path",{fill:"#fff",d:"M0 0h20v20H0z"})})})]})}),(0,i.jsx)("button",{onClick:()=>{var t,s,i,a,o,n;null===(t=e.game)||void 0===t||t.setFontSize(32),null===(n=e.game)||void 0===n||n.updateText(null===(s=e.game)||void 0===s?void 0:s.clickedShapeIndex,32,(null===(o=e.game)||void 0===o?void 0:null===(a=o.clickedShape)||void 0===a?void 0:null===(i=a.shape)||void 0===i?void 0:i.fontFamily)||"Satoshi")},title:"Large",className:"size-8 rounded-md bg-white flex items-center justify-center transition-all duration-200 ".concat((null===(j=e.game)||void 0===j?void 0:null===(S=j.clickedShape)||void 0===S?void 0:null===(w=S.shape)||void 0===w?void 0:w.fontSize)===32?"border-2 border-blue-500 shadow-lg scale-105":"border border-gray-300 hover:border-gray-400"),children:(0,i.jsxs)("svg",{"aria-hidden":"true",focusable:"false",role:"img",viewBox:"0 0 20 20",className:"text-black",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round",children:[(0,i.jsx)("g",{"clip-path":"url(#a)",children:(0,i.jsx)("path",{d:"M5.833 3.333v13.334h8.334",stroke:"currentColor","stroke-width":"1.25","stroke-linecap":"round","stroke-linejoin":"round"})}),(0,i.jsx)("defs",{children:(0,i.jsx)("clipPath",{id:"a",children:(0,i.jsx)("path",{fill:"#fff",d:"M0 0h20v20H0z"})})})]})}),(0,i.jsx)("button",{onClick:()=>{var t,s,i,a,o,n;null===(t=e.game)||void 0===t||t.setFontSize(36),null===(n=e.game)||void 0===n||n.updateText(null===(s=e.game)||void 0===s?void 0:s.clickedShapeIndex,36,(null===(o=e.game)||void 0===o?void 0:null===(a=o.clickedShape)||void 0===a?void 0:null===(i=a.shape)||void 0===i?void 0:i.fontFamily)||"Satoshi")},title:"Huge",className:"size-8 rounded-md bg-white flex items-center justify-center transition-all duration-200 ".concat((null===(I=e.game)||void 0===I?void 0:null===(N=I.clickedShape)||void 0===N?void 0:null===(C=N.shape)||void 0===C?void 0:C.fontSize)===36?"border-2 border-blue-500 shadow-lg scale-105":"border border-gray-300 hover:border-gray-400"),children:(0,i.jsx)("svg",{"aria-hidden":"true",focusable:"false",role:"img",viewBox:"0 0 20 20",className:"text-black",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round",children:(0,i.jsx)("path",{d:"m1.667 3.333 6.666 13.334M8.333 3.333 1.667 16.667M11.667 3.333v13.334h6.666",stroke:"currentColor","stroke-width":"1.25","stroke-linecap":"round","stroke-linejoin":"round"})})})]})]}),(0,i.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,i.jsx)("p",{className:"text-white text-sm",children:"Font Family"}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)("button",{onClick:()=>{var t,s,i,a,o,n,r;null===(t=e.game)||void 0===t||t.setFont("handwriting"),null===(r=e.game)||void 0===r||r.updateText(null===(s=e.game)||void 0===s?void 0:s.clickedShapeIndex,(null===(o=e.game)||void 0===o?void 0:null===(a=o.clickedShape)||void 0===a?void 0:null===(i=a.shape)||void 0===i?void 0:i.fontSize)||24,null===(n=e.game)||void 0===n?void 0:n.currentFont)},title:"Handwriting",className:"p-1 rounded-md transition-all duration-200 ".concat((null===(T=e.game)||void 0===T?void 0:null===(z=T.clickedShape)||void 0===z?void 0:null===(M=z.shape)||void 0===M?void 0:M.fontFamily)==="handwriting"?"bg-blue-100 border-2 border-blue-500 shadow-lg scale-105":"bg-white/90 border border-gray-300 hover:border-gray-400"),children:(0,i.jsx)(l.A,{className:"size-6 dark:text-black"})}),(0,i.jsx)("button",{onClick:()=>{var t,s,i,a,o,n,r;null===(t=e.game)||void 0===t||t.setFont("code"),null===(r=e.game)||void 0===r||r.updateText(null===(s=e.game)||void 0===s?void 0:s.clickedShapeIndex,(null===(o=e.game)||void 0===o?void 0:null===(a=o.clickedShape)||void 0===a?void 0:null===(i=a.shape)||void 0===i?void 0:i.fontSize)||24,null===(n=e.game)||void 0===n?void 0:n.currentFont)},title:"Code",className:"p-1 rounded-md flex items-center justify-center transition-all duration-200 ".concat((null===(F=e.game)||void 0===F?void 0:null===(P=F.clickedShape)||void 0===P?void 0:null===(Y=P.shape)||void 0===Y?void 0:Y.fontFamily)==="code"?"bg-blue-100 border-2 border-blue-500 shadow-lg scale-105":"bg-white border border-gray-300 hover:border-gray-400"),children:(0,i.jsx)(L.A,{className:"size-6 dark:text-black"})}),(0,i.jsx)("button",{onClick:()=>{var t,s,i,a,o,n,r;null===(t=e.game)||void 0===t||t.setFont("normal"),null===(r=e.game)||void 0===r||r.updateText(null===(s=e.game)||void 0===s?void 0:s.clickedShapeIndex,(null===(o=e.game)||void 0===o?void 0:null===(a=o.clickedShape)||void 0===a?void 0:null===(i=a.shape)||void 0===i?void 0:i.fontSize)||24,null===(n=e.game)||void 0===n?void 0:n.currentFont)},title:"Normal",className:"p-1 rounded-md flex items-center justify-center transition-all duration-200  ".concat((null===(W=e.game)||void 0===W?void 0:null===(H=W.clickedShape)||void 0===H?void 0:null===(J=H.shape)||void 0===J?void 0:J.fontFamily)==="normal"?"bg-blue-100 border-2 border-blue-500 shadow-lg scale-105":"bg-white border border-gray-300 hover:border-gray-400"),children:(0,i.jsx)(X.A,{className:"size-6 dark:text-black"})})]})]})]})}),(0,i.jsx)("div",{})]})})})};var J=s(45421),H=s(32352),W=s(2131),A=s(53160),U=s(66166),Z=s(18415),_=s(46925),R=s(27326),B=s(72290),G=s(30264),Q=s(39048);function V(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,Q.QP)((0,G.$)(t))}function q(e){let{...t}=e;return(0,i.jsx)(B.bL,{"data-slot":"dropdown-menu",...t})}function K(e){let{...t}=e;return(0,i.jsx)(B.l9,{"data-slot":"dropdown-menu-trigger",...t})}function $(e){let{className:t,sideOffset:s=4,...a}=e;return(0,i.jsx)(B.ZL,{children:(0,i.jsx)(B.UC,{"data-slot":"dropdown-menu-content",sideOffset:s,className:V("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",t),...a})})}var ee=s(27115),et=s(48180);let es=e=>{let{game:t,setShowClearCanvasModal:s,setShowLiveCollaborationModal:a,hasSelectedShape:o=!1,onEditClick:n}=e,r=(0,ee.useRouter)(),{theme:l,toggleTheme:d,setSystemTheme:h}=(0,et.D)();return(0,i.jsx)("div",{className:"fixed top-4 right-4 z-50 md:block hidden",children:(0,i.jsxs)(q,{children:[(0,i.jsx)(K,{onClick:()=>t.setTool("mouse"),children:(0,i.jsx)("button",{className:"border border-white/15 rounded-md dark:bg-[#191919] bg-black p-2 hover:opacity-80 transition-all duration-300",children:(0,i.jsx)(J.A,{className:"w-6 h-6 text-white "})})}),(0,i.jsxs)($,{collisionPadding:{right:12,top:15},className:"w-48 bg-[#191919] border border-white/15",children:[(0,i.jsxs)(B._2,{className:"w-full justify-between flex items-center gap-2 w-full  rounded-sm px-3 py-1.5 text-md outline-none text-white  rounded-lg transition-all ease-in-out cursor-pointer",children:[(0,i.jsx)("span",{className:" font-normal text-md  tracking-tighter text-inherit ",children:"Theme"}),(0,i.jsxs)("div",{className:"flex rounded-xl gap-2 border border-white/15 px-3 py-1",children:[(0,i.jsx)("button",{title:"Light Mode",onClick:e=>{e.preventDefault(),e.stopPropagation(),t.setTheme("light"),d()},children:(0,i.jsx)(H.A,{className:"size-6 px-1 rounded-md hover:opacity-80 transition-all duration-300 ".concat("light"===l?"bg-white text-black ":"text-white")})}),(0,i.jsx)("button",{title:"Dark Mode",onClick:e=>{e.preventDefault(),e.stopPropagation(),t.setTheme("dark"),d()},children:(0,i.jsx)(W.A,{className:"size-6 px-1 rounded-md hover:opacity-80 transition-all duration-300 ".concat("dark"===l?"bg-white text-black ":"text-white")})}),(0,i.jsx)("button",{title:"System Mode",onClick:e=>{e.preventDefault(),e.stopPropagation(),t.setTheme("system"),h()},children:(0,i.jsx)(A.A,{className:"size-6 px-1 rounded-md hover:opacity-80 transition-all duration-300 ".concat("system"===l?"bg-white text-black ":"text-white")})})]})]}),(0,i.jsx)(B.mB,{color:"f0f0f0",className:"bg-white/30 text-white/30"}),(0,i.jsxs)(B._2,{onClick:()=>{a(!0)},className:"w-full flex items-center gap-2 w-full  rounded-sm px-3 py-1.5 text-md outline-none text-white  transition-colors  hover:bg-gray-800 rounded-lg transition-all ease-in-out cursor-pointer",children:[(0,i.jsx)(U.A,{className:"size-5 text-inherit"}),(0,i.jsx)("span",{className:" font-normal text-md  tracking-tighter text-inherit ",children:"Live Collaboration"})]}),(0,i.jsxs)(B._2,{onClick:()=>{s(!0)},className:"w-full flex gap-2 w-full items-center  rounded-sm px-3 py-1.5 text-md outline-none text-white hover:text-red-600 transition-colors  hover:bg-gray-800 rounded-lg transition-all ease-in-out cursor-pointer",children:[(0,i.jsx)(Z.A,{className:"size-5 text-inherit"}),(0,i.jsx)("span",{className:"font-primary font-normal text-md tracking-tighter text-inherit ",children:"Clear Canvas"})]}),(0,i.jsx)(B.mB,{className:"bg-gray-600/30"}),(0,i.jsxs)(B._2,{onClick:()=>{r.push("/")},className:"w-full flex gap-2 w-full items-center  rounded-sm px-3 py-1.5 text-md outline-none text-white hover:text-red-600 transition-colors  hover:bg-gray-800 rounded-lg transition-all ease-in-out cursor-pointer",children:[(0,i.jsx)(_.A,{className:"size-5 text-inherit"}),(0,i.jsx)("span",{className:"font-primary font-normal text-md tracking-tighter text-inherit ",children:"Logout"})]})]})]})})},ei=e=>{let{game:t,setShowClearCanvasModal:s,setShowLiveCollaborationModal:a,hasSelectedShape:o=!1,onEditClick:n}=e,r=(0,ee.useRouter)(),{theme:l,toggleTheme:d,setSystemTheme:h}=(0,et.D)();return(0,i.jsxs)("div",{className:"fixed bottom-4 right-4 z-50 md:hidden",children:[(0,i.jsxs)(q,{children:[(0,i.jsx)(K,{onClick:()=>t.setTool("mouse"),children:(0,i.jsx)("button",{className:"border border-white/15 rounded-md dark:bg-[#191919] bg-black p-2 hover:opacity-80 transition-all duration-300",children:(0,i.jsx)(J.A,{className:"w-6 h-6 text-white "})})}),(0,i.jsxs)($,{collisionPadding:{right:12,bottom:15},className:"w-48 bg-[#191919] border border-white/15",children:[(0,i.jsxs)(B._2,{className:"w-full justify-between flex items-center gap-2 w-full  rounded-sm px-3 py-1.5 text-md outline-none text-white  rounded-lg transition-all ease-in-out cursor-pointer",children:[(0,i.jsx)("span",{className:" font-normal text-md  tracking-tighter text-inherit ",children:"Theme"}),(0,i.jsxs)("div",{className:"flex rounded-xl gap-2 border border-white/15 px-3 py-1",children:[(0,i.jsx)("button",{title:"Light Mode",onClick:e=>{e.preventDefault(),e.stopPropagation(),t.setTheme("light"),d()},children:(0,i.jsx)(H.A,{className:"size-6 px-1 rounded-md hover:opacity-80 transition-all duration-300 ".concat("light"===l?"bg-white text-black ":"text-white")})}),(0,i.jsx)("button",{title:"Dark Mode",onClick:e=>{e.preventDefault(),e.stopPropagation(),t.setTheme("dark"),d()},children:(0,i.jsx)(W.A,{className:"size-6 px-1 rounded-md hover:opacity-80 transition-all duration-300 ".concat("dark"===l?"bg-white text-black ":"text-white")})}),(0,i.jsx)("button",{title:"System Mode",onClick:e=>{e.preventDefault(),e.stopPropagation(),t.setTheme("system"),h()},children:(0,i.jsx)(A.A,{className:"size-6 px-1 rounded-md hover:opacity-80 transition-all duration-300 ".concat("system"===l?"bg-white text-black ":"text-white")})})]})]}),(0,i.jsx)(B.mB,{color:"f0f0f0",className:"bg-white/30 text-white/30"}),(0,i.jsxs)(B._2,{onClick:()=>{a(!0)},className:"w-full flex items-center gap-2 w-full  rounded-sm px-3 py-1.5 text-md outline-none text-white  transition-colors  hover:bg-gray-800 rounded-lg transition-all ease-in-out cursor-pointer",children:[(0,i.jsx)(U.A,{className:"size-5 text-inherit"}),(0,i.jsx)("span",{className:" font-normal text-md  tracking-tighter text-inherit ",children:"Live Collaboration"})]}),(0,i.jsxs)(B._2,{onClick:()=>{s(!0)},className:"w-full flex gap-2 w-full items-center  rounded-sm px-3 py-1.5 text-md outline-none text-white hover:text-red-600 transition-colors  hover:bg-gray-800 rounded-lg transition-all ease-in-out cursor-pointer",children:[(0,i.jsx)(Z.A,{className:"size-5 text-inherit"}),(0,i.jsx)("span",{className:"font-primary font-normal text-md tracking-tighter text-inherit ",children:"Clear Canvas"})]}),(0,i.jsx)(B.mB,{className:"bg-gray-600/30"}),(0,i.jsxs)(B._2,{onClick:()=>{r.push("/")},className:"w-full flex gap-2 w-full items-center  rounded-sm px-3 py-1.5 text-md outline-none text-white hover:text-red-600 transition-colors  hover:bg-gray-800 rounded-lg transition-all ease-in-out cursor-pointer",children:[(0,i.jsx)(_.A,{className:"size-5 text-inherit"}),(0,i.jsx)("span",{className:"font-primary font-normal text-md tracking-tighter text-inherit ",children:"Logout"})]})]})]}),o&&n&&(0,i.jsx)("div",{className:"fixed bottom-4 right-4 translate-x-[-60px] bg-[#191919] rounded-lg shadow-lg p-2 border border-gray-600/30",children:(0,i.jsx)(R.A,{size:20,className:"text-white cursor-pointer hover:text-gray-300 transition-colors",onClick:n})})]})};var ea=s(44470);let eo=(0,s(26378).F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function en(e){let{...t}=e;return(0,i.jsx)(ea.bL,{"data-slot":"alert-dialog",...t})}function er(e){let{...t}=e;return(0,i.jsx)(ea.ZL,{"data-slot":"alert-dialog-portal",...t})}function el(e){let{className:t,...s}=e;return(0,i.jsx)(ea.hJ,{"data-slot":"alert-dialog-overlay",className:V("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...s})}function ed(e){let{className:t,...s}=e;return(0,i.jsxs)(er,{children:[(0,i.jsx)(el,{}),(0,i.jsx)(ea.UC,{"data-slot":"alert-dialog-content",className:V("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...s})]})}function eh(e){let{className:t,...s}=e;return(0,i.jsx)("div",{"data-slot":"alert-dialog-header",className:V("flex flex-col gap-2 text-center sm:text-left",t),...s})}function ec(e){let{className:t,...s}=e;return(0,i.jsx)("div",{"data-slot":"alert-dialog-footer",className:V("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...s})}function ex(e){let{className:t,...s}=e;return(0,i.jsx)(ea.hE,{"data-slot":"alert-dialog-title",className:V("text-lg font-semibold",t),...s})}function eu(e){let{className:t,...s}=e;return(0,i.jsx)(ea.VY,{"data-slot":"alert-dialog-description",className:V("text-muted-foreground text-sm",t),...s})}function ep(e){let{className:t,...s}=e;return(0,i.jsx)(ea.rc,{className:V(eo(),t),...s})}function em(e){let{className:t,...s}=e;return(0,i.jsx)(ea.ZD,{className:V(eo({variant:"outline"}),t),...s})}let eg=e=>{let{setShowClearCanvasModal:t,showClearCanvasModal:s,game:o}=e,n=e=>{e&&(e.stopPropagation(),e.preventDefault()),t(!1)};return(0,a.useEffect)(()=>()=>{document.body.style.pointerEvents="auto"},[]),(0,i.jsx)(en,{open:s,onOpenChange:e=>{},children:(0,i.jsxs)(ed,{onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),onMouseUp:e=>e.stopPropagation(),className:"tracking-tight bg-gray-100 dark:bg-black border-gray-200 dark:bg-[#191919] dark:border-white/15 ",children:[(0,i.jsxs)(eh,{children:[(0,i.jsx)(ex,{children:"Clear Canvas"}),(0,i.jsx)(eu,{children:"This will clear the canvas and delete all elements. Are you sure?"})]}),(0,i.jsxs)(ec,{children:[(0,i.jsx)(em,{onClick:n,children:"Cancel"}),(0,i.jsx)(ep,{className:"bg-red-600 text-white hover:bg-red-700",onClick:()=>{null==o||o.clearCanvas(),n()},children:"Continue"})]})]})})};var ev=s(32871);let ef=e=>{let{setShowLiveCollaborationModal:t,showLiveCollaborationModal:s,game:a}=e,o=window.location.href,n=async()=>{try{await navigator.clipboard.writeText(o),console.log("Link copied to clipboard!")}catch(e){console.error("Failed to copy link:",e)}};return(0,i.jsx)("div",{onClick:()=>t(!1),className:"fixed inset-0 flex h-screen justify-center items-center bg-black/70 z-50",children:(0,i.jsxs)("div",{onClick:e=>e.stopPropagation(),className:"p-6 rounded-lg w-[90vw] md:w-96 bg-gray-100 dark:bg-black h-48 border border-gray-200 dark:border-white/15 shadow-xl tracking-tight flex text-center mx-auto flex-col gap-4",children:[(0,i.jsx)("h1",{className:"font-primary text-xl tracking-tighter text-black dark:text-white font-semibold",children:"Live Collaboration"}),(0,i.jsx)("h3",{className:"text-black dark:text-white",children:"Invite People to colloborate on your drawing"}),(0,i.jsxs)("div",{className:"flex items-stretch justify-between gap-2 p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-[#191919]",children:[(0,i.jsx)("a",{href:o,className:"underline text-sm truncate max-w-[200px] flex items-center text-black dark:text-white",target:"_blank",rel:"noopener noreferrer",children:o}),(0,i.jsx)("div",{className:"border-l border-gray-300 dark:border-gray-600 flex items-center",children:(0,i.jsx)("button",{onClick:n,className:"p-2  rounded transition-colors h-full w-full flex items-center justify-center",title:"Copy link",children:(0,i.jsx)(ev.A,{className:"w-5 h-5 text-gray-600 dark:text-gray-400 hover:opacity-70"})})})]})]})})};var ey=s(51599),ek=s(41519);let eb=e=>{let{setShowDisconnectedModal:t,showDisconnectedModal:s,game:a}=e;return(0,i.jsx)("div",{onClick:()=>t(!1),className:"fixed inset-0 flex h-screen justify-center items-center bg-black/70 z-50",children:(0,i.jsxs)("div",{onClick:e=>e.stopPropagation(),className:"p-6 rounded-lg w-[90vw] md:w-96 bg-gray-100 dark:bg-black h-64 border border-gray-200 dark:border-white/15 shadow-xl tracking-tight flex text-center mx-auto flex-col gap-4",children:[(0,i.jsx)("div",{className:"flex justify-center",children:(0,i.jsx)(ey.A,{className:"w-16 h-16 text-gray-600 dark:text-gray-400"})}),(0,i.jsx)("h1",{className:"font-primary text-xl tracking-tighter text-black dark:text-white font-semibold",children:"You Have Been Disconnected"}),(0,i.jsx)("h3",{className:"text-black dark:text-white text-sm",children:"Please refresh the page to reconnect to the server"}),(0,i.jsxs)("button",{onClick:()=>{window.location.reload()},className:"flex items-center justify-center gap-2 px-4 py-2 bg-gray-200 dark:bg-[#191919] hover:bg-gray-300 dark:hover:bg-gray-800 text-black dark:text-white rounded-lg transition-colors border border-gray-300 dark:border-gray-600",children:[(0,i.jsx)(ek.A,{className:"w-4 h-4"}),"Refresh"]})]})})};function ew(e){let{roomId:t,socket:s,session:o}=e,[n,r]=(0,a.useState)(),[l,d]=(0,a.useState)("rect"),{theme:h,toggleTheme:c}=(0,et.D)(),x=(0,a.useRef)(null),[u,p]=(0,a.useState)(!1),[m,g]=(0,a.useState)({index:-1,shape:void 0}),[v,f]=(0,a.useState)(!1),[y,k]=(0,a.useState)(!1),[b,w]=(0,a.useState)(0),[S,C]=(0,a.useState)(!1),[N,I]=(0,a.useState)(!1),[z,T]=(0,a.useState)(!0),[L,X]=(0,a.useState)(100),[O,D]=(0,a.useState)({x:0,y:0});return(0,a.useEffect)(()=>{null==n||n.setTool(l)},[l]),(0,a.useEffect)(()=>{if(x.current){let e=new M(x.current,t,s,d,o,h,()=>{w(e=>e+1)});return r(e),()=>{e.destroy()}}},[x]),(0,a.useEffect)(()=>{n&&(n.updateTransform(L,O),n.renderCanvas())},[L,O,n]),(0,a.useEffect)(()=>{var e,t;let s=()=>{x.current&&(x.current.width=window.innerWidth,x.current.height=window.innerHeight)};return console.log("Canvas data",null===(e=x.current)||void 0===e?void 0:e.width,null===(t=x.current)||void 0===t?void 0:t.height),s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),(0,a.useEffect)(()=>{if(!n)return;let e=n.clickedShapeIndex,t=n.clickedShape;if(e!==m.index||t!==m.shape){console.log("Shape selection changed:",e,t),g({index:e,shape:t});let s=window.innerWidth>=768;void 0!==e&&-1!==e?s&&p(!0):p(!1)}},[b,n,m.index,m.shape]),(0,a.useEffect)(()=>{if(!n)return;let e="text"===n.selectedTool&&0!==n.text.x&&0!==n.text.y;e!==v&&(console.log("Text input state changed:",e),f(e))},[b,n,v]),P({canvasRef:x,zoom:L,setZoom:X,panOffset:O,setPanOffset:D,scale:L/100,game:n}),(0,a.useEffect)(()=>{if(!s)return;let e=()=>{console.log("WebSocket connected"),T(!0),I(!1)},t=e=>{console.error("WebSocket error:",e),T(!1),I(!0)},i=e=>{console.log("WebSocket closed:",e.code,e.reason),T(!1),1e3!==e.code&&I(!0)};return s.addEventListener("open",e),s.addEventListener("close",i),s.addEventListener("error",t),s.readyState===WebSocket.OPEN?T(!0):(s.readyState===WebSocket.CLOSED||s.readyState===WebSocket.CLOSING)&&(T(!1),I(!0)),()=>{s.removeEventListener("open",e),s.removeEventListener("close",i),s.removeEventListener("error",t)}},[s]),(0,i.jsxs)("div",{className:"h-[100vh] w-full overflow-hidden ".concat("dark"===h?"dark":""),children:[!z&&(0,i.jsx)("div",{className:"fixed top-4 right-4 z-[9998] bg-red-500 text-white px-3 py-1 rounded-lg text-sm font-medium shadow-lg",children:"Disconnected"}),v&&(0,i.jsx)("div",{className:"absolute w-[100px] h-[30px] z-[9999]",style:{top:"".concat(((null==n?void 0:n.text.y)||0)*(L/100)+O.y,"px"),left:"".concat(((null==n?void 0:n.text.x)||0)*(L/100)+O.x,"px")},children:(0,i.jsx)("input",{type:"text",className:"text-2xl focus:outline-none min-w-auto h-full bg-transparent border-none ",style:{fontFamily:"Virgil, sans-serif",fontSize:"".concat(((null==n?void 0:n.fontSize)||24)*(L/100),"px")},autoFocus:!0,ref:e=>{e&&(e.focus(),e.setSelectionRange(0,0))},onChange:e=>{n&&(n.text.text=e.target.value)},onBlur:()=>{n&&(n.sendText(),n.text.text="",n.text.x=0,n.text.y=0)},onKeyDown:e=>{"Enter"===e.key&&n&&(n.sendText(),n.text.text="",n.text.x=0,n.text.y=0)}})}),(0,i.jsx)(es,{game:n,setShowLiveCollaborationModal:C,setShowClearCanvasModal:k}),(0,i.jsx)(ei,{game:n,setShowLiveCollaborationModal:C,setShowClearCanvasModal:k,hasSelectedShape:-1!==m.index,onEditClick:()=>p(e=>!e)}),(0,i.jsx)(j,{selectedTool:l,setSelectedTool:d}),(0,i.jsx)("canvas",{className:"z-[9999]",ref:x}),(0,i.jsx)(Y,{zoom:L,onZoomChange:X}),(0,i.jsx)(F,{game:n,clickedShapeIndex:m.index,shape:m.shape,showShapeConfigModal:u,setShowShapeConfigModal:p,canvasUpdateTrigger:b}),y&&(0,i.jsx)(eg,{game:n,setShowClearCanvasModal:k,showClearCanvasModal:y}),S&&(0,i.jsx)(ef,{game:n,setShowLiveCollaborationModal:C,showLiveCollaborationModal:S}),N&&(0,i.jsx)(eb,{game:n,setShowDisconnectedModal:I,showDisconnectedModal:N})]})}var eS=s(3052),ej=s(28293),eC=s(2754);let eN=()=>{let[e,t]=(0,a.useState)(0);(0,a.useEffect)(()=>{let e=setInterval(()=>{t(e=>(e+1)%4)},600);return()=>clearInterval(e)},[]);let s=[{x:-20,y:-20},{x:20,y:-20},{x:20,y:20},{x:-20,y:20}];return(0,i.jsx)("div",{className:"w-screen h-screen dark:bg-black bg-white overflow-hidden",children:(0,i.jsxs)("div",{className:"absolute bottom-20 left-16 flex items-center gap-6",children:[(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)(D.P.div,{initial:{x:s[0].x,y:s[0].y},animate:{x:s[e].x,y:s[e].y},transition:{duration:.5,ease:"easeInOut"},className:"absolute",children:(0,i.jsx)(ej.A,{className:"size-10 text-foreground"})}),(0,i.jsx)(D.P.div,{initial:{x:s[1].x,y:s[1].y},animate:{x:s[(e+1)%4].x,y:s[(e+1)%4].y},transition:{duration:.5,ease:"easeInOut"},className:"absolute",children:(0,i.jsx)(eC.A,{className:"size-10 text-foreground"})}),(0,i.jsx)(D.P.div,{initial:{x:s[2].x,y:s[2].y},animate:{x:s[(e+2)%4].x,y:s[(e+2)%4].y},transition:{duration:.5,ease:"easeInOut"},className:"absolute",children:(0,i.jsx)(n.A,{className:"size-10 text-foreground"})}),(0,i.jsx)(D.P.div,{initial:{x:s[3].x,y:s[3].y},animate:{x:s[(e+3)%4].x,y:s[(e+3)%4].y},transition:{duration:.5,ease:"easeInOut"},className:"absolute",children:(0,i.jsx)(l.A,{className:"size-10 text-foreground"})})]}),(0,i.jsx)("div",{className:"text-base font-medium text-foreground/80 tracking-wide"})]})})};function eI(e){let{roomId:t}=e,[s,n]=(0,a.useState)(null),[r,l]=(0,a.useState)(null),[d,h]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{let e;let s=null;(async function(){console.log("session",s=await (0,eS.getSession)()),s&&l(s),e=new WebSocket("".concat(o.Z,"/?token=").concat((null==s?void 0:s.accessToken)||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6ImI0Y2Q4ZWM3LTM1NWUtNGZlYy04YzNiLWIwYzUyYmU1MTFlMCIsImlhdCI6MTc1MzgwNjQ1NH0.bER-qZ5Lvk39mxILYj8O09aIjFeA5x8A1mST4dLyu7I")),console.log("".concat(o.Z,"/?token=").concat(null==s?void 0:s.accessToken)),e.onopen=()=>{n(e),console.log("conncted ws"),console.log(t),e.send(JSON.stringify({type:"join_room",roomId:t})),setTimeout(()=>{h(!0)},1e3)},e.onclose=()=>{console.log("WebSocket connection closed")}})()},[t]),s&&d)?(0,i.jsx)("div",{children:(0,i.jsx)(ew,{roomId:t,socket:s,session:r})}):(0,i.jsx)(eN,{})}},58183:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a,f:()=>i});let i="https://slapdashbe.piyushxz.online",a="wss://slapdashws.piyushxz.online"},48180:(e,t,s)=>{"use strict";s.d(t,{D:()=>r,N:()=>n});var i=s(36694),a=s(83286);let o=(0,a.createContext)(void 0);function n(e){let{children:t}=e,[s,n]=(0,a.useState)("dark");return(0,a.useEffect)(()=>{let e=localStorage.getItem("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;e?n(e):t?n("dark"):n("light")},[]),(0,a.useEffect)(()=>{let e=window.document.documentElement;e.classList.remove("light","dark","system"),e.classList.add(s),localStorage.setItem("theme",s)},[s]),(0,i.jsx)(o.Provider,{value:{theme:s,toggleTheme:()=>{n(e=>"light"===e?"dark":"light")},setSystemTheme:()=>{n(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}},children:t})}function r(){let e=(0,a.useContext)(o);if(void 0===e)throw Error("useTheme must be used within a ThemeProvider");return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[778,589,52,334,909,659,358],()=>t(90178)),_N_E=e.O()}]);